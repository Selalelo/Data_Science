{% extends "base.html" %}
{% block title %}Add User - User Management System{% endblock %}
{% block extra_css %}
<style>
    .form-container { max-width: 800px; margin: 0 auto; }
    h1 { color: #2d3748; margin-bottom: 30px; }
    .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; }
    .form-group { margin-bottom: 20px; }
    .form-group.full-width { grid-column: 1 / -1; }
    label { display: block; margin-bottom: 5px; color: #4a5568; font-weight: 500; }
    input, select { width: 100%; padding: 10px; border: 2px solid #e2e8f0; border-radius: 5px; font-size: 16px; }
    input:focus, select:focus { outline: none; border-color: #667eea; }
    .radio-group { display: flex; gap: 20px; }
    .radio-group label { display: flex; align-items: center; font-weight: normal; }
    .radio-group input[type="radio"] { width: auto; margin-right: 5px; }
    button { padding: 12px 30px; background: #667eea; color: white; border: none; border-radius: 5px; font-size: 16px; font-weight: 600; cursor: pointer; }
    button:hover { background: #5a67d8; }
    .error { color: #e53e3e; font-size: 14px; margin-top: 5px; }
</style>
{% endblock %}

{% block content %}
<div class="form-container">
    <h1>Add New User</h1>
    <form id="addUserForm" onsubmit="handleSubmit(event)">
        <div class="form-grid">
            <div class="form-group">
                <label for="first_name">First Name *</label>
                <input type="text" id="first_name" name="first_name" required>
            </div>
            <div class="form-group">
                <label for="last_name">Last Name (Surname) *</label>
                <input type="text" id="last_name" name="last_name" required>
            </div>
            <div class="form-group">
                <label for="password">Password *</label>
                <input type="password" id="password" name="password" maxlength="20" required>
            </div>
            <div class="form-group">
                <label for="date_of_birth">Date of Birth *</label>
                <input type="date" id="date_of_birth" name="date_of_birth" required>
            </div>
            <div class="form-group">
                <label for="province">Province *</label>
                <select id="province" name="province" required>
                    <option value="">Select a province</option>
                    {% for prov in provinces %}
                    <option value="{{ prov }}">{{ prov }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="form-group">
                <label for="gender">Gender *</label>
                <select id="gender" name="gender" required>
                    <option value="">Select gender</option>
                    <option value="Male">Male</option>
                    <option value="Female">Female</option>
                    <option value="Other">Other</option>
                </select>
            </div>
            <div class="form-group full-width">
                <label>Facilitator *</label>
                <div class="radio-group">
                    <label><input type="radio" name="facilitator" value="true" required> Yes</label>
                    <label><input type="radio" name="facilitator" value="false" required> No</label>
                </div>
            </div>
        </div>
        <div id="errorMessage" class="error"></div>
        <div id="successMessage" class="alert alert-success" style="display:none;"></div>
        <button type="submit">Save User</button>
    </form>
</div>

<script>
async function handleSubmit(event) {
    event.preventDefault();
    const form = event.target;
    const formData = new FormData(form);
    
    const userData = {
        first_name: formData.get('first_name'),
        last_name: formData.get('last_name'),
        password: formData.get('password'),
        date_of_birth: formData.get('date_of_birth'),
        province: formData.get('province'),
        gender: formData.get('gender'),
        facilitator: formData.get('facilitator') === 'true'
    };
    
    try {
        const response = await fetch('/api/users/', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(userData)
        });
        
        if (response.ok) {
            const successMsg = document.getElementById('successMessage');
            successMsg.textContent = 'User created successfully!';
            successMsg.style.display = 'block';
            form.reset();
            setTimeout(() => { window.location.href = '/users/manage'; }, 2000);
        } else {
            const data = await response.json();
            document.getElementById('errorMessage').textContent = data.detail || 'Failed to create user';
        }
    } catch (error) {
        document.getElementById('errorMessage').textContent = 'An error occurred';
    }
}
</script>
{% endblock %}
