{% extends "base.html" %}
{% block title %}Delete User{% endblock %}
{% block extra_css %}
<style>
    .delete-container { max-width: 600px; margin: 0 auto; text-align: center; padding: 40px; background: #fff5f5; border-radius: 10px; border: 2px solid #feb2b2; }
    h1 { color: #742a2a; margin-bottom: 20px; }
    .user-info { background: white; padding: 20px; border-radius: 5px; margin: 30px 0; }
    .user-info h3 { color: #2d3748; margin-bottom: 10px; }
    .user-info p { color: #4a5568; font-size: 18px; }
    .warning-text { color: #c53030; margin-bottom: 30px; font-weight: 600; }
    .button-group { display: flex; gap: 15px; justify-content: center; }
    button, .btn { padding: 12px 30px; border: none; border-radius: 5px; font-size: 16px; font-weight: 600; cursor: pointer; text-decoration: none; display: inline-block; }
    .btn-danger { background: #f56565; color: white; }
    .btn-danger:hover { background: #e53e3e; }
    .btn-secondary { background: #718096; color: white; }
    .btn-secondary:hover { background: #4a5568; }
</style>
{% endblock %}

{% block content %}
<div class="delete-container">
    <h1>⚠️ Delete User</h1>
    <div class="user-info">
        <h3>User Details</h3>
        <p><strong>{{ user_data.first_name }} {{ user_data.last_name }}</strong></p>
    </div>

    {# LOGIC: Only show the delete button if the logged-in user's ID is 1 #}
    {% if user.user_id == 1 %}
        {% if user_data.user_id == 1 %}
            <p class="warning-text" style="color: #718096;">You cannot delete yourself, even as an Admin.</p>
            <div class="button-group">
                <a href="/users/manage" class="btn btn-secondary">Go Back</a>
            </div>
        {% else %}
            <p class="warning-text">Are you sure you want to delete this user?<br>This action cannot be undone!</p>
            <div class="button-group">
                <button onclick="deleteUser()" class="btn-danger">Yes, Delete</button>
                <a href="/users/manage" class="btn btn-secondary">No, Cancel</a>
            </div>
        {% endif %}
    {% else %}
        {# MESSAGE FOR NON-ADMINS #}
        <div class="alert alert-error" style="background: #fff5f5; color: #c53030; padding: 15px; border-radius: 5px; border: 1px solid #feb2b2;">
            <strong>Access Denied:</strong> You do not have permission to delete users.
        </div>
        <div class="button-group" style="margin-top: 20px;">
            <a href="/users/manage" class="btn btn-secondary">Return to Management</a>
        </div>
    {% endif %}
    
    <div id="errorMessage" class="alert alert-error" style="display:none; margin-top:20px;"></div>
</div>


<script>
async function deleteUser() {
    try {
        const response = await fetch('/api/users/{{ user_data.user_id }}', {
            method: 'DELETE'
        });
        
        if (response.ok || response.status === 204) {
            alert('User deleted successfully!');
            window.location.href = '/users/manage';
        } else {
            const data = await response.json();
            const errorMsg = document.getElementById('errorMessage');
            errorMsg.textContent = data.detail || 'Failed to delete user';
            errorMsg.style.display = 'block';
        }
    } catch (error) {
        const errorMsg = document.getElementById('errorMessage');
        errorMsg.textContent = 'An error occurred';
        errorMsg.style.display = 'block';
    }
}
</script>
{% endblock %}
